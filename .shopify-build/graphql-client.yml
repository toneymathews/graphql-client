containers:
  default:
    build:
      from: ubuntu-latest
      type: ci
      ruby: 2.7.2

shared:
  defaults: &defaults
    timeout: 10m

    run:
      - bundle: ~
      - bundle exec rake test

steps:
  - label: ":ruby: Ruby Tests"
    timeout: 10m
    run:
      - bundle: ~
      - bundle exec rake test

  - label: ":rubocop: Ruby Lint"
    timeout: 10m
    run:
      - bundle: ~
      - bundle exec rubocop

  - label: ":ruby: Ruby Tests (latest dependencies)"
    timeout: 10m
    run:
      - rm Gemfile.lock
      - bundle: { cache_version: latest-gems }
      - bundle exec rake test

  - label: ":ruby: Ruby Tests - graphql-1.10"
    env:
      BUNDLE_GEMFILE: gemfiles/graphql-1.10.gemfile
    <<: *defaults

  - label: ":ruby: Ruby Tests - graphql 1.11"
    env:
      BUNDLE_GEMFILE: gemfiles/graphql-1.11.gemfile
    <<: *defaults

  - label: ":ruby: Ruby Tests - graphql 1.12"
    env:
      BUNDLE_GEMFILE: gemfiles/graphql-1.12.gemfile
    <<: *defaults
